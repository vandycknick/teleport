---
title: Database Access with AWS DynamoDB
description: How to access AWS DynamoDB with Teleport Database Access
---

Access to AWS DynamoDB can be provided by [Teleport Database
Access](../introduction.mdx) for the AWS Console and API. This allows for
fine-grain access control through [Teleport's RBAC](../../application-access/introduction.mdx).

This guide will help you to:

- Install the Teleport Database Service.
- Set up the Teleport Database Service to access the AWS Console and API.
- Connect to your DynamoDB databases through the Teleport Database Service.

<ScopedBlock scope={["oss", "enterprise"]}>
![DynamoDB Self-Hosted](../../../img/database-access/guides/aws-dynamodb_selfhosted.png)
</ScopedBlock>
<ScopedBlock scope={["cloud"]}>
![DynamoDB Cloud](../../../img/database-access/guides/aws-dynamodb_cloud.png)
</ScopedBlock>

## Prerequisites

- AWS account with DynamoDB databases.
- IAM permissions to create IAM roles.
- `aws` Command Line Interface (CLI) tool installed in PATH.
- A host, e.g., an EC2 instance, where you will run the Teleport Database Service.
  This guide assumes an EC2 instance when creating and applying IAM roles, and
  must be adjusted accordingly for custom configurations.

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

(!docs/pages/includes/tctl.mdx!)

<Admonition type="tip" title="Not yet a Teleport user?">
If you have not yet deployed the Auth Service and Proxy Service, you should follow
one of our [getting started guides](../getting-started.mdx) or try our Teleport
Application Access [interactive learning track](https://play.instruqt.com/teleport/invite/rgvuva4gzkon).
</Admonition>

We will assume your Teleport cluster is accessible at `teleport.example.com` and
`*.teleport.example.com`. You can substitute the address of your Teleport Proxy
Service. (For Teleport Cloud customers, this will be similar to `mytenant.teleport.sh`.)

<Admonition type="note" title="Example Access Control">
This guide provides an example configuration of IAM access roles as a model,
and uses an EC2 instance to serve the Teleport Database Access service.
The level of access provided may not suit your needs, or may not fit your
organization's access conventions. Adjust as needed to fit your needs.
</Admonition>

## Step 1/4. Create IAM roles for DynamoDB access

The setup described in this guide requires two IAM roles:

- one to identify the EC2 instance running the Teleport Database Access service,
- one applied to users that allows the former role to assume it, and allows
access to DynamoDB.

### EC2 instance role

Visit the [Roles page](https://console.aws.amazon.com/iamv2/home#/roles) of
the AWS Console, then press "Create Role". Under **Trusted entity type** select
"AWS service". Under **Use case** select "EC2", then click **Next**.

![Create Role to Identify EC2 Instance](../../../img/database-access/guides/dynamodb-create-ec2-role.png)

This role requires no permissions, so on the next page you can click **Next**,
then name the role and click **Create Role**. In this guide we'll use the example
name `TeleportDatabaseService` for this role.

### DynamoDB access role

Navigate back to the Roles page and create a new role. Select the "AWS account"
option, which creates a default trust policy to allow other entities in this
account to assume this role:

![Create Role Step 1](../../../img/database-access/guides/dynamodb-create-role-1.png)

Press "Next". Find the AWS-managed policy `AmazonDynamoDBFullAccess` and then select the policy:

![Create Role Step 2](../../../img/database-access/guides/dynamodb-create-role-2.png)

<Admonition type="note" title="Apply least-privilege permissions">
`AmazonDynamoDBFullAccess` may provide too much access for your intentions. To
use a different IAM policy to reduce permissions, see [Managing access
permissions to your Amazon DynamoDB
Resources](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/access-control-overview.html)
for more details.
</Admonition>

Press "Next". On the next page, enter a role name. In this guide we'll use
the example name `ExampleTeleportDynamoDBRole` for this role.

Under "Select trusted entities", update the JSON to allow the `TeleportDatabaseService`
role to assume this role:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": [
                    "arn:aws:iam::(=aws.aws_access_key=):role/ExampleTeleportDynamoDBRole"
                ]
            },
            "Action": "sts:AssumeRole",
            "Condition": {}
        }
    ]
}
```

Finally, click "Create role".

## Step 2/4. Configure the Teleport IAM role mapping

The next step is to give your Teleport users permissions to assume IAM roles in
your Teleport cluster.

You can do this by creating a Teleport role with the `aws_role_arns` field
listing the IAM role ARN created in the previous step. Create a file called
`aws-dynamodb-access.yaml` with the following content:

```yaml
kind: role
version: v5
metadata:
  name: aws-dynamodb-access
spec:
  allow:
    app_labels:
      '*': '*'
    aws_role_arns:
    - arn:aws:iam::(=aws.aws_access_key=):role/ExampleTeleportDynamoDBRole
```

<Details title="Templating aws_role_arns" opened={false}>
The `aws_role_arns` field supports template variables so they can be populated
dynamically based on your users' identity provider attributes. See [Role
Templates](../../access-controls/guides/role-templates.mdx) for details.
</Details>

Create the new role:

```code
$ tctl create -f aws-dynamodb-access.yaml
```

(!docs/pages/includes/add-role-to-user.mdx role="aws-dynamodb-access"!)

## Step 3/4. Install the Teleport Database Service

Create and EC2 instance to host the Teleport Database Service, and attach the
`TeleportDatabaseService` to it. If you're hosting the service another way, you
must provide AWS authentication to the host manually.

<Admonition type="warning" title="non-standard AWS regions">
For non-standard AWS regions such as AWS GovCloud (US) regions and AWS China
regions, please set the corresponding region in the `AWS_REGION` environment
variable or in the AWS credentials file so that the Application Service can use
the correct STS endpoint.
</Admonition>

### Generate a token

A join token is required to authorize a Teleport Database Service instance
to join the cluster. Generate a short-lived join token and save the output of
the command:

```code
$ tctl tokens add \
    --type=db \
    --db-name=aws-dynamodb
```

Use the token provided by the output of this command in the next step.

### Install and start Teleport

Install Teleport on the host where you will run the Teleport Application
Service. See our [Installation](../../installation.mdx) page for options
besides Linux servers.

(!docs/pages/includes/install-linux.mdx!)

Edit `/etc/teleport.yaml` to configure the database entry:

```yaml
version: v3
teleport:
  nodename: CHANGEME
  data_dir: /var/lib/teleport
  proxy_server: teleport.example.com
  auth_token: (=presets.tokens.first=)
  ca_pin:
  - (=presets.ca_pin=)
db_service:
  enabled: "yes"
  # Matchers for database resources created with "tctl create" command.
  # For more information: https://goteleport.com/docs/database-access/guides/dynamic-registration/
  resources:
  - labels:
      "*": "*"
  # Lists statically registered databases proxied by this agent.
  databases:
    - name: "aws-dynamodb"
      protocol: "dynamodb"
      # optional uri, if uri is set then AWS region can be extracted from it
      # or if AWS region is already set then the regions must match.
      # uri: "dynamodb.us-east-1.amazonaws.com:443"
      static_labels:
        env: "dev"
      aws:
        region: "us-east-1"
        account_id: "(=aws.aws_access_key=)"
```

Now start the Teleport Database Service:

<Tabs>
<TabItem label="Package Manager">

```code
$ sudo systemctl start teleport
```

</TabItem>
<TabItem label="TAR archive">

```code
$ sudo teleport install systemd --output=/etc/systemd/system/teleport.service;
$ sudo systemctl enable teleport
$ sudo systemctl start teleport
```

</TabItem>
</Tabs>

## Step 4/4 Connect

Once the Database Service has started and joined the cluster, you can start
connecting to your DynamoDB database.

Create a proxy tunnel:

```code
$ tsh proxy db --tunnel --port 8000 --db-user=ExampleTeleportDynamoDBRole dynamodb-name
```

You can test the connection to the database through the `aws` cli:

```code
$ aws dynamodb list-tables --endpoint-url=http://localhost:8000
{
    "TableNames": [
        "table1",
        "table2",
        "table3"
    ]
}
```
