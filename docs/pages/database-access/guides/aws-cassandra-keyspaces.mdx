---
title: Database Access with AWS Keyspaces (Apache Cassandra)
description: How to configure Teleport Database Access with AWS Keyspaces (Apache Cassandra)
---

<Details
  title="Version warning"
  opened={true}
  scope={["oss", "enterprise"]}
  scopeOnly={true}
  min="11.0"
>
  Database Access for AWS Keyspaces (Apache Cassandra) is available starting from Teleport `v11.0`.
</Details>


This guide will help you to:

- Install and configure Teleport.
- Set up Teleport to access AWS Keyspaces (Apache Cassandra).
- Connect to your database through Teleport.

<ScopedBlock scope={["oss", "enterprise"]}>
![Teleport Database Access Redis Self-Hosted](../../../img/database-access/guides/cassandra_keyspaces_selfhosted.png)
</ScopedBlock>
<ScopedBlock scope={["cloud"]}>
![Teleport Database Access Redis Cloud](../../../img/database-access/guides/cassandra_keyspaces_cloud.png)
</ScopedBlock>

## Prerequisites

- AWS Account with AWS Keyspaces database and permissions to create and attach IAM policies
- The `cqlsh` Cassandra client installed and added to your system's `PATH` environment variable.
- A host, e.g., an Amazon EC2 instance, where you will run the Teleport Database Service.

(!docs/pages/includes/user-client-prereqs.mdx!)


## Step 1/5. Install and configure Teleport

### Set up the Teleport Auth and Proxy Services

(!docs/pages/includes/database-access/start-auth-proxy.mdx!)

### Set up the Teleport Database Service

(!docs/pages/includes/database-access/token.mdx!)

Install Teleport on the host where you will run the Teleport Database Service:

(!docs/pages/includes/install-linux.mdx!)

<ScopedBlock scope={["oss", "enterprise"]}>

Start the Teleport Database Service, pointing the `--auth-server` flag to the
address of your Teleport Proxy Service:

```code
$ teleport db start \
  --token=/tmp/token \
  --auth-server=teleport.example.com:443 \
  --name=keyspaces \
  --protocol=cassandra \
  --aws-account-id=12345678912 \
  --aws-region=us-east-1 \
  --labels=env=dev
```

<Admonition type="note">

The `--auth-server` flag must point to the Teleport cluster's Proxy Service
endpoint because the Database Service always connects back to the cluster over a
reverse tunnel.

</Admonition>

</ScopedBlock>
<ScopedBlock scope={["cloud"]}>

Start the Teleport Database Service, pointing the `--auth-server` flag to the
address of your Teleport Cloud tenant:

```code
$ teleport db start \
  --token=/tmp/token \
  --auth-server=mytenant.teleport.sh:443 \
  --name=keyspaces \
  --protocol=cassandra \
  --aws-account-id=12345678912 \
  --aws-region=us-east-1 \
  --labels=env=dev
```

</ScopedBlock>

<Admonition type="tip">
  You can start the Database Service using a configuration file instead of CLI flags.
  See the [YAML reference](../reference/configuration.mdx) for details.
</Admonition>

## Step 2/5. Create a Teleport user

(!docs/pages/includes/database-access/create-user.mdx!)


## Step 3/5. Create an AWS Keyspaces role

Create an AWS IAM Role that will be used as your Keyspaces user.
Go to the IAM -> Access Management -> [Roles](https://console.aws.amazon.com/iamv2/home#/roles).
Press Create Role.

![Create Role Step 1](../../../img/database-access/guides/keyspaces/create-role-step1.png)
AWS provides the `AmazonKeyspacesReadOnlyAccess` and `AmazonKeyspacesFullAccess` IAM policies that you can incorporate into your Keyspaces user's role.
You can choose `AmazonKeyspacesReadOnlyAccess` for read-only access to AWS Keyspaces or `AmazonKeyspacesFullAccess` for full access.

<Admonition type="tip">
  The `AmazonKeyspacesReadOnlyAccess` and `AmazonKeyspacesReadOnlyAccess` policies may
  provide too much or not enough access for your intentions.
  Validate that these meet your expectations if you plan on using them.
  You can also create your own custom AWS Keyspaces Permissions Policies: [Amazon Keyspaces identity-based policy examples](https://docs.aws.amazon.com/keyspaces/latest/devguide/security_iam_id-based-policy-examples.html).
</Admonition>

![Create Role Step 1](../../../img/database-access/guides/keyspaces/create-role-step2.png)
Enter a role name and press "Create role".
![Create Role Step 1](../../../img/database-access/guides/keyspaces/create-role-step3.png)


## Step 4/5. Give Teleport permissions to assume roles

Next, attach the following policy to the IAM role or IAM user the Teleport
Database Service instance is using, which allows the Database Service to
assume the IAM roles:

```yaml
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "sts:AssumeRole",
      "Resource": "*"
    }
  ]
}
```

<Admonition type="tip">
  You can make the policy more strict by providing specific IAM role resource
  ARNs in the "Resource" field instead of using a wildcard.
</Admonition>


## Step 5/5. Connect

Once the Database Service has joined the cluster, log in to see the available
databases:

<ScopedBlock scope={["oss", "enterprise"]}>

  ```code
  $ tsh login --proxy=teleport.example.com --user=alice
  $ tsh db ls
  # Name      Description Allowed Users Labels  Connect
  # --------- ----------- ------------- ------- -------
  # keyspaces             [*]           env=dev
  ```

</ScopedBlock>
<ScopedBlock scope={["cloud"]}>

  ```code
  $ tsh login --proxy=mytenant.teleport.sh --user=alice
  $ tsh db ls
  # Name      Description Allowed Users Labels  Connect
  # --------- ----------- ------------- ------- -------
  # keyspaces             [*]           env=dev
  ```

</ScopedBlock>

To connect to a particular database instance using the `KeyspacesReader`  AWS IAM Keyspaces role as a database user:
```code
$ tsh db connect --db-user=KeyspacesReader keyspaces
# Connected to Amazon Keyspaces at localhost:55084
# [cqlsh 6.0.0 | Cassandra 3.11.2 | CQL spec 3.4.4 | Native protocol v4]
# Use HELP for help.
# KeyspacesReader@cqlsh>
```

To log out of the database and remove credentials:

```code
# Remove credentials for a particular database instance.
$ tsh db logout keyspaces
# Remove credentials for all database instances.
$ tsh db logout
```

## Further reading

- [How Amazon Keyspaces works with IAM](https://docs.aws.amazon.com/keyspaces/latest/devguide/security_iam_service-with-iam.html)
- [What is Amazon Keyspaces (for Apache Cassandra)?](https://docs.aws.amazon.com/keyspaces/latest/devguide/what-is-keyspaces.html)

## Next steps

(!docs/pages/includes/database-access/guides-next-steps.mdx!)
